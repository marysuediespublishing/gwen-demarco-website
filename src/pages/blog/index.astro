---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import FormattedDate from '../../components/FormattedDate.astro';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Get unique categories for filtering
const categories = [...new Set(posts.map(post => post.data.category).filter(Boolean))];
---

<Layout title="Blog - Gwen DeMarco" description="Insights from my writing journey, book launch announcements, and behind-the-scenes peeks into the weird and wonderful worlds of urban fantasy.">
	<main id="main-content" class="relative">
		<!-- Hero Section -->
		<section class="relative py-16 bg-gradient-night overflow-hidden">
			<!-- Background fog effect -->
			<div class="absolute inset-0 bg-gradient-fog opacity-40"></div>
			<div class="absolute inset-0 bg-gradient-to-t from-shadow-black/50 to-transparent"></div>

			<div class="container mx-auto px-4 text-center relative z-10">
				<div class="max-w-4xl mx-auto space-y-6">
					<h1 class="text-4xl md:text-6xl font-primary font-bold text-bone-white mb-4">
						<span class="bg-gradient-to-r from-mystic-violet via-ember-orange to-mystic-teal bg-clip-text text-transparent">
							Behind the Stories
						</span>
					</h1>
					<p class="text-xl md:text-2xl text-ember-orange font-medium">
						Insights from my writing journey & the worlds I create
					</p>
					<p class="text-lg text-moon-silver/90 max-w-2xl mx-auto leading-relaxed">
						Discover the inspiration behind my paranormal romances, character development insights, and glimpses into the creative process.
					</p>
				</div>
			</div>
		</section>

		<!-- Category Filter (if categories exist) -->
		{categories.length > 0 && (
			<section class="py-6 bg-dark-surface border-b border-dark-border">
				<div class="container mx-auto px-4">
					<div class="flex flex-wrap items-center justify-center gap-3">
						<span class="text-fog-gray text-sm mr-2">Filter by:</span>
						<button
							class="filter-btn badge badge-primary active"
							data-category="all"
						>
							All Posts
						</button>
						{categories.map((category) => (
							<button
								class="filter-btn badge badge-outline hover:badge-primary transition-all duration-200"
								data-category={category}
							>
								{category?.toString().split('-').map(word =>
									word.charAt(0).toUpperCase() + word.slice(1)
								).join(' ')}
							</button>
						))}
					</div>
				</div>
			</section>
		)}

		<!-- Blog Posts Section -->
		<section class="py-16 bg-bg-secondary">
			<div class="container mx-auto px-4">
				{posts.length === 0 ? (
					<div class="text-center py-12">
						<p class="text-fog-gray text-lg">No blog posts yet. Check back soon!</p>
					</div>
				) : (
					<ul class="grid gap-8 md:grid-cols-2">
						{
							posts.map((post, index) => {
								// Create dynamic gradient overlays based on post index
								const gradientOverlays = [
									'bg-gradient-to-br from-mystic-violet/20 via-transparent to-ember-orange/30',
									'bg-gradient-to-tr from-ember-orange/25 via-transparent to-mystic-violet/20',
									'bg-gradient-to-bl from-mystic-teal/20 via-transparent to-ember-orange/25',
									'bg-gradient-to-tl from-mystic-violet/20 via-transparent to-mystic-teal/25',
									'bg-gradient-to-br from-ember-orange/15 via-transparent to-mystic-violet/20'
								];
								const overlayClass = gradientOverlays[index % gradientOverlays.length];

								return (
									<li
										class={`blog-post ${index === 0 ? "md:col-span-2" : ""}`}
										data-category={post.data.category || 'uncategorized'}
									>
										<a
											href={`/blog/${post.id}/`}
											class="block group card card-hover overflow-hidden"
										>
											{post.data.heroImage && (
												<div class="relative overflow-hidden">
													<img
														width="720"
														height="360"
														src={post.data.heroImage}
														alt=""
														class="w-full h-48 object-cover object-[center_33%] group-hover:scale-105 transition-transform duration-300"
													/>
													<div class={`absolute inset-0 ${overlayClass} mix-blend-overlay group-hover:opacity-75 transition-opacity duration-300`}></div>
													<div class="absolute inset-0 bg-gradient-to-t from-shadow-black/60 via-transparent to-transparent"></div>
												</div>
											)}
											<div class="p-6">
												{/* Category badge */}
												{post.data.category && (
													<span class="badge badge-series text-xs mb-3">
														{post.data.category.toString().split('-').map(word =>
															word.charAt(0).toUpperCase() + word.slice(1)
														).join(' ')}
													</span>
												)}

												<h4 class="text-xl font-semibold font-primary text-bone-white group-hover:text-ember-orange transition-colors mb-2">
													{post.data.title}
												</h4>

												{post.data.description && (
													<p class="text-fog-gray text-sm mb-3 line-clamp-2">
														{post.data.description}
													</p>
												)}

												<div class="flex items-center justify-between text-sm">
													<span class="text-mystic-teal">
														<FormattedDate date={post.data.pubDate} />
													</span>
													{post.data.readingTime && (
														<span class="text-fog-gray">
															{post.data.readingTime}
														</span>
													)}
												</div>

												{/* Tags */}
												{post.data.tags && post.data.tags.length > 0 && (
													<div class="flex flex-wrap gap-2 mt-4">
														{post.data.tags.slice(0, 3).map((tag: string) => (
															<span class="text-xs text-fog-gray/70 bg-midnight-purple/30 px-2 py-1 rounded">
																#{tag}
															</span>
														))}
													</div>
												)}
											</div>
										</a>
									</li>
								);
							})
						}
					</ul>
				)}
			</div>
		</section>

		<!-- Newsletter CTA -->
		<section class="py-16 px-4 bg-gradient-to-r from-midnight-purple via-shadow-black to-midnight-purple">
			<div class="container mx-auto text-center">
				<div class="max-w-2xl mx-auto">
					<h2 class="font-primary text-2xl md:text-3xl font-bold text-bone-white mb-4">
						Never Miss a Post
					</h2>
					<p class="text-moon-silver/90 mb-6">
						Subscribe to get notified about new releases, exclusive content, and behind-the-scenes peeks into my writing journey.
					</p>
					<button type="button" class="btn btn-primary px-6 py-3 newsletter-trigger">
						Subscribe Now
					</button>
				</div>
			</div>
		</section>
	</main>
</Layout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.blog-post.hidden {
		display: none;
	}

	.filter-btn.active {
		@apply bg-ember-orange/15 text-ember-orange border-ember-orange/40;
	}
</style>

<script>
	// Category filtering
	document.addEventListener('DOMContentLoaded', () => {
		const filterButtons = document.querySelectorAll('.filter-btn');
		const blogPosts = document.querySelectorAll('.blog-post');

		filterButtons.forEach(button => {
			button.addEventListener('click', () => {
				const category = button.getAttribute('data-category');

				// Update active button
				filterButtons.forEach(btn => btn.classList.remove('active'));
				button.classList.add('active');

				// Filter posts
				blogPosts.forEach(post => {
					const postCategory = post.getAttribute('data-category');
					if (category === 'all' || postCategory === category) {
						post.classList.remove('hidden');
					} else {
						post.classList.add('hidden');
					}
				});
			});
		});
	});
</script>
